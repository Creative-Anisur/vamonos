<html><head>

    <link rel="stylesheet" href="../lib/vamonos.css">
    <link rel="stylesheet" href="demos.css">
    <script type="text/javascript" src="../deps/jquery.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-jsplumb.js"></script>
    <script type="text/javascript" src="../lib/vamonos.js"></script>

    <style type="text/css">
        .vertex-contents {
            font-family: sans-serif;
            font-size: .8em;
        }

        .vertex {
            -webkit-transition-property: top, left;
            -webkit-transition-duration: 1 s;
            -webkit-transition-delay: 0s;
            -webkit-transition-timing-function: ease;
        }
        
        .vertex-sw-label {
            font-size: .8em;
            color: red;
        }

    </style>

</head>
<body>

    <h1>AVL Tree demo using Vamonos</h1>

    <table class="vamonos">
        <tr><td class="pseudocode-and-controls">

            <div id="controls"></div>

            <div class="pseudocode-procedures">
                <div id="pseudocode-insert" title="Insert(node, newval):">
                        if newval < node.val
                            if node.left == null 
                                node.left = new Node(newval)
                            else
                                Insert(node.left, newval)
                        else
                            if node.right == null
                                node.right = new Node(newval)
                            else
                                Insert(node.right, newval)
                        UpdateHeight(node)
                        return Restructure(node)
                </div>

            </div>

        </td><td class="variable-widgets">

            input here maybe

            <table class="variable-widgets">
                <tr><td><div id="tree-var"></div></td>
                    <td><div id="tree"></div></td>
                </tr>
                <tr><td><div id="node-var"></div></td>
                    <td><div id="node"></div></td>
                </tr>
                <tr><td><div id="stack-var"></div></td>
                    <td><div id="stack"></div></td></tr>
                </tr>
            </table>

        </td></tr>
    </table>


</body>

<script type="text/javascript">
var myviz = new Vamonos.Visualizer({
    widgets: [
        new Vamonos.Widget.Console(),

        new Vamonos.Widget.VarName({
            container: "stack-var",
            varName: "_callstack",
            displayName: "Call Stack",
            watching: true
        }),

        new Vamonos.Widget.CallStack({
            container: "stack",
            procedureNames: {
                insert: "Insert",
            },
            animate: ["next", "prev"]
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode-insert",
            procedureName: "insert",
        }),

        new Vamonos.Widget.Controls({
            container: "controls"
        }),

        new Vamonos.Widget.VarName({
            container: "node-var",
            varName: "node",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "node",
            varName: "node",
            attributes: ["val", "left","right","height"]
        }),

        new Vamonos.Widget.VarName({
            container: "tree-var",
            varName: "tree",
        }),

        new Vamonos.Widget.BinaryTree({
            container: "tree",
            varName: "tree",
            vertexLabels: {
                inner: function(n){ return n.val },
                sw: function(n){ return n.height },
                nw: ["node"],
            },
            colorEdges: [
                [ function(e){
                    return (
                        e.target.next ? 
                        e.target.next.id === e.source.id :
                        false
                    ) || (
                        e.source.next ?
                        e.source.next.id === e.target.id :
                        false
                    )
                  }
                , "#92E894" ],
            ],
            defaultTree: new Vamonos.DataStructure.BinaryTree({
                id: "n5",
                val: 5,
                height: 1,
                left: { 
                    id: "n3",
                    val: 3,
                    height: 0,
                },
                right: {
                    id: "n8",
                    val: 8,
                    height: 0,
                },
            }),
        }),


    ],

    autoStart: false,

    algorithm: {
        main: function(_) {
            with (this) {
            }
        },

        insert: function(_) {
            with (this) {
                if (newval < node.val) {
                    if (typeof node.left === 'undefined') {
                        node.left = { val: newval, height: 0 };
                    } else {
                        node.left = insert({newval: newval, node: node.left});
                    }
                } else {
                    if (typeof node.right === 'undefined') {
                        node.right = { val: newval, height: 0 };
                    } else {
                        node.right = insert({newval: newval, node: node.left});
                    }                
                }
                updateHeight({node: node});
                return restructure({node: node});
                
            }
        },

        updateHeight: function(_) {
            with (this) {
                var hl = node.left === null ? -1 : node.left.height;
                var hr = node.right === null ? -1 : node.right.height;
                node.height = Math.max(hl, hr);
            }
        },

        balanceFactor: function(_) {
            with (this) {
                var hl = node.left === null ? -1 : node.left.height;
                var hr = node.right === null ? -1 : node.right.height;
                return hl - hr;
            }
        },

        restructure: function(_) {
            with (this) {
                if (balanceFactor({node: node}) == 2) {
                    if (balanceFactor({node: node.left}) == -1) {
                        node.left = node.left.rotateLeft();
                    }
                    return node.rotateRight();
                } else if (balanceFactor({node: node}) == -2) {
                    if (balanceFactor({node: node.right}) == 1) {
                        node.right = node.right.rotateRight();
                    }
                    return node.rotateLeft();
                } else {
                    return node;
                }
            }
        },
    },
})
</script>
</html>
