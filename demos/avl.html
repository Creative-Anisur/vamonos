<!--

TODO 
show each rotation seperately
    which probably means restructure needs to be a procedure not a BinaryTree method

clean up pathway highlighting

-->

<html><head>

    <link rel="stylesheet" href="../lib/vamonos.css">
    <link rel="stylesheet" href="demos.css">
    <script type="text/javascript" src="../deps/jquery.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-jsplumb.js"></script>
    <script type="text/javascript" src="../lib/vamonos.js"></script>

    <style type="text/css">

        .vertex {
            width: 40;
            height: 30;
            -webkit-transition-property: top, left;
            -webkit-transition-duration: 1 s;
            -webkit-transition-delay: 0s;
            -webkit-transition-timing-function: ease;
        }
        
        .vertex-contents {
            font-size: .8em;
        }

        .vertex-ne-label, .vertex-nw-label {
            font-weight: bold;
        }

        .vertex-sw-label {
            font-style: italic;
            font-size: .8em;
        }

        .current {
            box-shadow:0px 0px 5px 5px #FCFBBB;
        }

    </style>

</head>
<body>

    <h1>AVL Tree demo using Vamonos</h1>

    <table class="vamonos">
        <tr><td class="pseudocode-and-controls">

            <div id="controls"></div>

            <div class="pseudocode-procedures">
                <div id="pseudocode-insert" title="node.insert(v):">
                    if v < val
                        if left is null 
                            left = new Node(v)
                        else
                            left.insert(v)
                    else
                        if right is null
                            right&nbsp;=&nbsp;new&nbsp;Node(v)
                        else
                            right.insert(v)
                    updateHeight()
                    restructure()
                </div>
                <div id="pseudocode-restructure" title="node.restructure():">
                    if balanceFactor is 2
                        if left.balanceFactor is -1
                            left.rotateLeft()
                        rotateRight()
                    else if balanceFactor is -2
                        if right.balanceFactor is 1
                            right.rotateRight()
                        rotateLeft()
                    updateHeight()
            </div>

        </td><td class="variable-widgets">

            <table class="variable-widgets">
                <tr><td><div id="insertVal-var"></div></td>
                    <td><div id="insertVal"></div></td>
                </tr>
                <tr><td><div id="deleteVar-var"></div></td>
                    <td><div id="deleteVar"></div></td>
                </tr>
                <tr><td><div id="tree-var"></div></td>
                    <td><div id="tree"></div></td>
                </tr>
                <tr><td><div id="node-var"></div></td>
                    <td><div id="node"></div></td>
                </tr>
                <tr><td><div id="stack-var"></div></td>
                    <td><div id="stack"></div></td></tr>
                </tr>
            </table>

        </td></tr>
    </table>


</body>

<script type="text/javascript">
var myviz = new Vamonos.Visualizer({
    widgets: [
        new Vamonos.Widget.Console(),

        new Vamonos.Widget.VarName({
            container: "insertVal-var",
            varName: "insertVal",
            displayName: "Insert Value",
            watchable: false,
        }),

        new Vamonos.Widget.VarDisplay({
            container: "insertVal",
            varName: "insertVal",
            input: true,
        }),

        new Vamonos.Widget.VarName({
            container: "deleteVar-var",
            varName: "deleteVar",
            displayName: "Delete Value",
            watchable: false,
        }),

        new Vamonos.Widget.VarDisplay({
            container: "deleteVar",
            varName: "deleteVar",
            input: true,
        }),

        new Vamonos.Widget.VarName({
            container: "stack-var",
            varName: "_callstack",
            displayName: "Call Stack",
        }),

        new Vamonos.Widget.CallStack({
            container: "stack",
            procedureNames: {
                insert: "Insert",
            },
            animate: ["next", "prev"]
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode-insert",
            procedureName: "insert",
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode-restructure",
            procedureName: "restructure",
        }),

        new Vamonos.Widget.Controls({
            container: "controls",
            showWhileSliding: false,
        }),

        new Vamonos.Widget.VarName({
            container: "node-var",
            varName: "node",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "node",
            varName: "node",
            attributes: ["val", "left","right","height"]
        }),

        new Vamonos.Widget.VarName({
            container: "tree-var",
            varName: "tree",
            watching: true,
        }),

        new Vamonos.Widget.BinaryTree({
            container: "tree",
            varName: "tree",
            vertexLabels: {
                inner: function(n){ return n.val },
                sw: function(n){ return n.height },
                arbitrary: function($node, vertex, frame) {
                    if (frame.This && frame.This.id === vertex.id) {
                        $node.addClass("current");
                    } else {
                        $node.removeClass("current");
                    }
                }
            },
            defaultTree: new Vamonos.DataStructure.BinaryTree({
                id: "n5",
                val: 5,
                height: 1,
                left: { 
                    id: "n3",
                    val: 3,
                    height: 0,
                },
                right: {
                    id: "n8",
                    val: 8,
                    height: 0,
                },
            }),
        }),


    ],

    autoStart: false,

    algorithm: {
        main: function(_) {
            with (this) {
                global.tree = tree;
                if (typeof insertVal === 'number') {
                    insert({This: tree.guts, v: insertVal, _tailCall: true});
                }
                if (typeof deleteVal === 'number') {
                    nodedelete({This: tree.guts, deleteVal: deleteVal, _tailCall: true});
                }
            }
        },

        insert: function(_) {
            with (this) {
                if (_(1), v < This.val) {
                    if (_(2), typeof This.left === 'undefined') {
_(3);                   This.left = global.tree.newNode(v);
                        global.tree.refresh();
                    } else {
                        insert({This: This.left, v: v});
                    }
                } else {
_(6);               if (_(7), typeof This.right === 'undefined') {
_(8);                   This.right = global.tree.newNode(v);
                        global.tree.refresh();
                    } else {
_(9); _(10);            insert({This: This.right, v: v});
                    }
                }
_(11);          global.tree.updateHeight(This.id);
_(12);          restructure({This: This});
            }
        },

        restructure: function(_) {
            with (this) {
                if (_(1), global.tree.balanceFactor(This.id) == 2) {
                    if (_(2), global.tree.balanceFactor(This.left.id) == -1) {
_(3);                   global.tree.rotateLeft(This.left.id);
                    }
_(4);               global.tree.rotateRight(This.id);
                } else if (_(5), global.tree.balanceFactor(This.id) == -2) {
                    if (_(6), global.tree.balanceFactor(This.right.id) == 1) {
_(7);                   global.tree.rotateRight(This.right.id);
                    }
_(8);               global.tree.rotateLeft(This.id);
                }
_(9);           global.tree.updateHeights();
            }
        },
    },
})
</script>
</html>
