<!--

TODO 
show each rotation seperately
    which probably means restructure needs to be a procedure not a BinaryTree method

clean up pathway highlighting

-->

<html><head>

    <link rel="stylesheet" href="../lib/vamonos.css">
    <link rel="stylesheet" href="demos.css">
    <script type="text/javascript" src="../deps/jquery.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-jsplumb.js"></script>
    <script type="text/javascript" src="../lib/vamonos.js"></script>

    <style type="text/css">
        .vertex-contents {
            font-family: sans-serif;
            font-size: .8em;
        }

        .vertex {
            -webkit-transition-property: top, left;
            -webkit-transition-duration: 1 s;
            -webkit-transition-delay: 0s;
            -webkit-transition-timing-function: ease;
        }
        
        .vertex-sw-label {
            font-size: .8em;
            color: red;
        }

    </style>

</head>
<body>

    <h1>AVL Tree demo using Vamonos</h1>

    <table class="vamonos">
        <tr><td class="pseudocode-and-controls">

            <div id="controls"></div>

            <div class="pseudocode-procedures">
                <div id="pseudocode-insert" title="node.insert(newVal):">
                        if newVal < val
                            if left == null 
                                left = new Node(newVal)
                            else
                                left.insert(newVal)
                        else
                            if right == null
                                right&nbsp;=&nbsp;new&nbsp;Node(newVal)
                            else
                                right.insert(newVal)
                        updateHeight()
                        restructure()
                </div>

            </div>

        </td><td class="variable-widgets">

            <table class="variable-widgets">
                <tr><td><div id="insertVal-var"></div></td>
                    <td><div id="insertVal"></div></td>
                </tr>
                <tr><td><div id="deleteVar-var"></div></td>
                    <td><div id="deleteVar"></div></td>
                </tr>
                <tr><td><div id="tree-var"></div></td>
                    <td><div id="tree"></div></td>
                </tr>
                <tr><td><div id="node-var"></div></td>
                    <td><div id="node"></div></td>
                </tr>
                <tr><td><div id="stack-var"></div></td>
                    <td><div id="stack"></div></td></tr>
                </tr>
            </table>

        </td></tr>
    </table>


</body>

<script type="text/javascript">
var myviz = new Vamonos.Visualizer({
    widgets: [
        new Vamonos.Widget.Console(),

        new Vamonos.Widget.VarName({
            container: "insertVal-var",
            varName: "insertVal",
            displayName: "Insert Value",
            watchable: false,
        }),

        new Vamonos.Widget.VarDisplay({
            container: "insertVal",
            varName: "insertVal",
            input: true,
        }),

        new Vamonos.Widget.VarName({
            container: "deleteVar-var",
            varName: "deleteVar",
            displayName: "Delete Value",
            watchable: false,
        }),

        new Vamonos.Widget.VarDisplay({
            container: "deleteVar",
            varName: "deleteVar",
            input: true,
        }),

        new Vamonos.Widget.VarName({
            container: "stack-var",
            varName: "_callstack",
            displayName: "Call Stack",
            watching: true
        }),

        new Vamonos.Widget.CallStack({
            container: "stack",
            procedureNames: {
                insert: "Insert",
            },
            animate: ["next", "prev"]
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode-insert",
            procedureName: "insert",
        }),

        new Vamonos.Widget.Controls({
            container: "controls"
        }),

        new Vamonos.Widget.VarName({
            container: "node-var",
            varName: "node",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "node",
            varName: "node",
            attributes: ["val", "left","right","height"]
        }),

        new Vamonos.Widget.VarName({
            container: "tree-var",
            varName: "tree",
        }),

        new Vamonos.Widget.BinaryTree({
            container: "tree",
            varName: "tree",
            vertexLabels: {
                inner: function(n){ return n.val },
                sw: function(n){ return n.height },
                nw: ["node@n"],
            },
            colorEdges: [
                [ function(e){
                    return (
                        e.target.next ? 
                        e.target.next.id === e.source.id :
                        false
                    ) || (
                        e.source.next ?
                        e.source.next.id === e.target.id :
                        false
                    )
                  }
                , "#92E894" ],
            ],
            defaultTree: new Vamonos.DataStructure.BinaryTree({
                id: "n5",
                val: 5,
                height: 1,
                left: { 
                    id: "n3",
                    val: 3,
                    height: 0,
                },
                right: {
                    id: "n8",
                    val: 8,
                    height: 0,
                },
            }),
        }),


    ],

    autoStart: false,

    algorithm: {
        main: function(_) {
            with (this) {
                global.tree = tree;
                if (typeof insertVal === 'number') {
                    insert({node: tree.guts, newVal: insertVal, _tailCall: true});
                }
                global.tree.eachNodeInOrder(function(n){n.next = undefined});
                if (typeof deleteVal === 'number') {
                    nodedelete({node: tree.guts, deleteVal: deleteVal, _tailCall: true});
                }
            }
        },

        insert: function(_) {
            with (this) {
                if (_(1), newVal < node.val) {
                    if (_(2), typeof node.left === 'undefined') {
_(3);                   global.tree.changeAttr(node.id, "left", global.tree.newNode(newVal))
                        node.next = node.left;
                    } else {
_(4); _(5);             node.next = node.left;
                        insert({node: node.left, newVal: newVal});
                    }
                } else {
_(6);               if (_(7), typeof node.right === 'undefined') {
_(8);                   global.tree.changeAttr(node.id, "right", global.tree.newNode(newVal))
                        node.next = node.right;
                    } else {
                        node.next = node.right;
_(9); _(10);            insert({node: node.right, newVal: newVal});
                    }
                }
                node.next = undefined;
_(11);          global.tree.updateHeights(node.id);
_(12);          global.tree.restructure(node.id);
            }
        },
    },
})
</script>
</html>
