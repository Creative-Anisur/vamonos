<html><head>

    <link rel="stylesheet" href="../lib/vamonos.css">
    <link rel="stylesheet" href="demos.css">
    <script type="text/javascript" src="../deps/jquery.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../deps/jquery-jsplumb.js"></script>
    <script type="text/javascript" src="../lib/vamonos.js"></script>

<style>
    td {
        vertical-align: top;
    }
</style>

</head><body>

    <h1>Dijkstra's Algorithm</h1>

    <table><tr><td>
        <div id="pseudocode" title="Dijkstra(G,s):" class="container">
            for each vertex u &in; G.V - {s}
                u.d = &#x221E;
                u.pred = null
                u.done = false
            s.d = 0
            Q = G.V
            while Q &ne; &empty;
                u = Q.extractMin()
                u.done = true
                for each v &in; G.Adj[u]
                    Relax(u,v)
        </div><br>
        <div id="controls"></div><br>
    </td><td>
        <div id="graph" class="container"></div><br>
        <div id="queue"></div><br>
    </td></tr></table>

</body>
<script type="text/javascript">
var myviz = new Vamonos.Visualizer({
    widgets: [
        new Vamonos.Widget.Console(),

        new Vamonos.Widget.Controls({
            container: "controls",
            showWhileSliding: true,
        }),

        new Vamonos.Widget.Queue({
            container: "queue",
            varName: "Q",
            displayOnly: true,
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode",
            setAllBreakpoints: true,
        }),

        new Vamonos.Widget.Graph({
            varName: "G",
            container: "graph",
            inputVars: {
                s: "v0",
            },
            vertexSetupFunc: function(v, $vtx) {
                $vtx.append([
                    $("<div>", { class:'vertex-ne-label' }),
                    $("<div>", { class:'vertex-sw-label' }),
                    $("<div>", { class:'vertex-nw-label' }),
                ]);
                $vtx.children("div.vertex-contents").text(v.name);
            },
            vertexUpdateFunc: function(v, $vtx) {
                var clearColor = function () { $vtx.removeClass('white black gray') };
                if (v.color == "white") { clearColor(); $vtx.addClass('white') } 
                else if (v.color == "gray") { clearColor(); $vtx.addClass('gray') } 
                else if (v.color == "black") { clearColor(); $vtx.addClass('black') }
                else { clearColor() }
                $vtx.children("div.vertex-contents").text(v.name);
                $vtx.children("div.vertex-sw-label").text(v.d === undefined ? "" : v.d);
            },

            renderEdgeLabel: function (edge) {
                return edge.w;
            },

            renderEdgeStyle: function (edge) {
                if (edge.target.pred && edge.target.pred.id == edge.source.id)
                    {return {strokeStyle: '#c88', lineWidth: 4};} //forward edge
                return {lineWidth: 2};
            },

            showVertices: {
                u: {
                    show: function($vtx){ $vtx.children("div.vertex-ne-label").html("u") },
                    hide: function($vtx){ $vtx.children("div.vertex-ne-label").html("") },
                },
                v: {
                    show: function($vtx){ $vtx.children("div.vertex-ne-label").html("v") },
                    hide: function($vtx){ $vtx.children("div.vertex-ne-label").html("") },
                },
                s: {
                    show: function($vtx){ $vtx.children("div.vertex-nw-label").text("s") },
                    hide: function($vtx){ $vtx.children("div.vertex-nw-label").text("") },
                },
            },
            showEdges: {
                "u->v": {
                    show: function($edge){$edge.setPaintStyle({strokeStyle:"red",lineWidth:3})},
                    hide: function($edge){$edge.setPaintStyle({strokeStyle:"gray",lineWidth:2})},
                },
            },
            defaultGraph: new Vamonos.DataStructure.Graph({
                vertices: [ 
                    {id: "v0", x: 17,  y: 10},
                    {id: "v1", x: 98, y: 10},
                    {id: "v2", x: 176, y: 13},
                    {id: "v3", x: 15,  y: 78},
                    {id: "v4", x: 100, y: 80},
                    {id: "v5", x: 182, y: 80},
                    {id: "v6", x: 15,  y: 138},
                    {id: "v7", x: 100, y: 140},
                    {id: "v8", x: 182, y: 140},
                ],
                edges: [
                    {source: 'v0',target: 'v4'},
                    {source: 'v1',target: 'v2'},
                    {source: 'v1',target: 'v4'},
                    {source: 'v3',target: 'v4'},
                    {source: 'v3',target: 'v6'},
                    {source: 'v4',target: 'v8'},
                    {source: 'v5',target: 'v8'},
                    {source: 'v6',target: 'v7'},
                    {source: 'v7',target: 'v8'},
                ]
            }),
        }),
    ],

    algorithm: {

        main: function (viz) {
            var _ = function(n){ viz.line(n) };
            with (viz.namespace.main) {

                for (var i = vs.length - 1; _(1), i >= 0; i--) {
_(2);               vs[i].d = Infinity;
_(3);               vs[i].pred = null;
_(4);               vs[i].done = false;
                }
_(5);           s.d = 0;
_(6);           Q = new Vamonos.DataStructure.PriorityQueue({
                    initialArray: G.vertices,
                    comparator: function(a,b){ return a.d - b.d },
                });

                while (_(7), Q.length > 0) {
                    u = Q.extractMin();
                    u.is_u = 1;
                    u.done = true;
                    vs = graph.getNeighbors(u);
                    vs.sort( function(a,b){ return b.name.localeCompare(a.name) });
                    for (var i = vs.length - 1; i >= 0; i--) {
                        v = vs[i];
                        v.is_v = 1;
                        if (u.d + graph.edge(u,v).w < v.d) {
                            v.d = u.d + graph.edge(u,v).w;
                            v.pred = u;
                        }
                        v.is_v = 0;
                    }
                    u.is_u = 0;
            }

        }

    }
    }
});

</script></html> 
