<html><head>

    <meta id="meta" name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />

    <link rel="stylesheet" href="../lib/vamonos.css">
    <link rel="stylesheet" href="../lib/vamonos-demos.css">
    <script type="text/javascript" src="../lib/vamonos-all.js"></script>

    <style type="text/css">
    .vertex {
        fill: #eee;
        stroke: #888;
        stroke-width: 1;
    }

    .vertex-contents {
        font-size: .8em;
        font-weight: bold;
    }

    .vertex-ne-label, .vertex-nw-label {
        font-weight: bold;
    }

    .vertex-sw-label {
        font-style: italic;
    }

    .done {
        background: #ddd;
    }

    .color-white {
        background: white;
    }

    .color-gray {
        background: #888;
    }

    .color-black {
        background: black;
    }

    .color-black .vertex-contents, .color-gray .vertex-contents {
        color: white;
    }

    line.edge {
        stroke: #cccccc;
        stroke-width: 4;
    }

    body {
        text-align: center;
    }
    </style>

</head><body>

    <h1>D3 Prototype</h1>

    <table id='graph'>

        <tr><td>
            <ol>
                <li>draw a graph using graph datastructure<br></li>
                <li>use groups for all node related things? - labels, pop-ups</li>
                <li>add edge labels - again groups?</li>
                <li>draggablilty - ticks?</li>
                <li>integrate d3 in graph display widget</li>
            </ol>
        </td></tr>

    </table>

</body>
<script type="text/javascript">
var g = new Vamonos.DataStructure.Graph({
    vertices: [
        {id: "v0", x: 17,  y: 10},
        {id: "v1", x: 98,  y: 10},
        {id: "v2", x: 176, y: 13},
        {id: "v3", x: 15,  y: 78},
        {id: "v4", x: 100, y: 80},
        {id: "v5", x: 182, y: 80},
        {id: "v6", x: 15,  y: 138},
        {id: "v7", x: 100, y: 140},
        {id: "v8", x: 182, y: 140},
    ],
    edges: [
        {source: 'v0',target: 'v4', w:1},
        {source: 'v1',target: 'v2', w:2},
        {source: 'v1',target: 'v4', w:5},
        {source: 'v3',target: 'v4', w:3},
        {source: 'v3',target: 'v6', w:1},
        {source: 'v4',target: 'v8', w:10},
        {source: 'v5',target: 'v8', w:2},
        {source: 'v6',target: 'v7', w:3},
        {source: 'v7',target: 'v8', w:2},
    ]
});

var width = 20;
var height = 15;

showGraph({ container: "graph", graph: g });

function showGraph(args){
    var g = args.graph;
    var contId = args.container;

    d3.selectAll("#" + contId)
      .attr("class", "vamonos")
      .append("tr")
      .append("td")
      .append("div")
      .append("svg")
      .attr("height", 200)
      .attr("width", 250)
      .call(drawEdges, g)
      .call(drawVertices, g);
}

function drawEdges(selector, graph){
    var groups = selector.selectAll("g.edge")
        .data(g.getEdges())
        .enter()
        .append("g")
        .attr("class", "edge");

    // TODO translate edge groups, put label in correct position

    var edges = groups.append("line")
        .attr("x1", function(d){ return g.vertex(d.source).x + width  })
        .attr("y1", function(d){ return g.vertex(d.source).y + height })
        .attr("x2", function(d){ return g.vertex(d.target).x + width  })
        .attr("y2", function(d){ return g.vertex(d.target).y + height })
        .attr("class", "edge");

    var labels = groups.append("text")
        .attr("x", 0)
        .attr("y", 0)
        .text(function(d){ return d.w });

    return selector;
}

function drawVertices(selector, graph){
    var groups = selector.selectAll("g.vertex")
        .data(g.getVertices())
        .enter()
        .append("g");

    function transVertex(vtx){
        return "translate(" + (vtx.x + width) + "," + (vtx.y + height) + ")";
    }

    groups.attr("transform", transVertex)
          .append("ellipse")
          .attr("class", "vertex")
          .attr("cx", 0)
          .attr("cy", 0)
          .attr("rx", width)
          .attr("ry", height);

    groups.append("text")
          .attr("x", -4)
          .attr("y", 4)
          .attr("class", "vertex-contents")
          .text(function(d){ return d.name });

    return selector;
}

</script></html>
