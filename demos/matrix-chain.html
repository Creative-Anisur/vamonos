<html><head>

    <link rel="stylesheet" href="../lib/vamonos.css">
    <script type="text/javascript" src="../lib/vamonos-all.js"></script>

    <style type="text/css">
        td.row-i.col-k {
            background-color: #ada;
        }
        td.row-i.col-j, td.row-jplus1.col-k {
            background-color: #ccc;
        }
        body {
            text-align: center;
        }
    </style>

</head><body>

    <h1>Matrix-chain Multiplication demo using Vamonos</h1>

    <table class="vamonos">
        <tr><td class="pseudocode-and-controls">
            <div id="controls"></div>
            <div class="pseudocode-procedures">
                <div id="pseudocode" title="MatrixChainMult(dim):">
                    for i = 1 to dim.length - 1
                        opt[i,i] = 0
                        sol[i,i] = "M i"
                    for l = 2 to dim.length
                        for i = 1 to dim.length - l
                            k = i + l - 1
                            opt[i,k] = &infin;
                            for j = i to k-1
                                if opt[i,k] &gt; dim[i-1]*dim[j]*dim[k] + best[i,j] + best[j+1,k]
                                    opt[i,k] = dim[i-1]*dim[j]*dim[k] + best[i,j] + best[j+1,k]
                                    sol[i,k] = "(sol[i][j] sol[j+1][k])"
                </div>
            </div>
        </td><td class="variable-widgets">
            <table class="variable-widgets">
                <tr><td><div id="i-var"></div></td>
                    <td><div id="i"></div></td>
                </tr>
                <tr><td><div id="j-var"></div></td>
                    <td><div id="j"></div></td>
                </tr>
                <tr><td><div id="k-var"></div></td>
                    <td><div id="k"></div></td>
                </tr>
                <tr><td><div id="l-var"></div></td>
                    <td><div id="l"></div></td>
                </tr>
                <tr><td><div id="dim-var"></div></td>
                    <td><div id="dim"></div></td>
                </tr>
                <tr><td><div id="opt-var"></div></td>
                    <td><div id="opt"></div></td>
                </tr>
                <tr><td><div id="sol-var"></div></td>
                    <td><div id="sol"></div></td>
                </tr>
            </table>
        </td></tr>
    </div>
</body>

<script type="text/javascript">
var myviz = new Vamonos.Visualizer({
    widgets: [
        new Vamonos.Widget.VarName({
            container: "i-var",
            varName: "i",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "i",
            varName: "i",
        }),

        new Vamonos.Widget.VarName({
            container: "j-var",
            varName: "j",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "j",
            varName: "j",
        }),

        new Vamonos.Widget.VarName({
            container: "k-var",
            varName: "k",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "k",
            varName: "k",
        }),

        new Vamonos.Widget.VarName({
            container: "l-var",
            varName: "l",
        }),

        new Vamonos.Widget.VarDisplay({
            container: "l",
            varName: "l",
        }),

        new Vamonos.Widget.VarName({
            container: "dim-var",
            varName: "dim",
            inputVar: true,
            watchable: false
        }),

        new Vamonos.Widget.Array({
            container: "dim",
            showLabel: true,
            varName: "dim",
            defaultInput: [4, 3, 5, 1, 2, 7],
            showIndices: ["i-1", "j", "k"],
        }),

        new Vamonos.Widget.VarName({
            container: "opt-var",
            varName: "global::opt",
            displayName: "opt",
        }),

        new Vamonos.Widget.Matrix({
            container: "opt",
            varName: "global::opt",
            cssRules: [
                ["row", ">", "col", "shaded"],
                ["row", "=", "i", "row-i"],
                ["col", "=", "j", "col-j"],
                ["row", "=", "j+1", "row-jplus1"],
                ["col", "=", "k", "col-k"],
            ],
            showIndices: [
                ["row", "i"],
                ["row", "j+1"],
                ["col", "j"],
                ["col", "k"]
            ]
        }),

        new Vamonos.Widget.VarName({
            container: "sol-var",
            varName: "global::sol",
            displayName: "sol",
            watching: true,
        }),

        new Vamonos.Widget.Matrix({
            container: "sol",
            varName: "global::sol",
            cssRules: [
                ["row", ">", "col", "shaded"],
                ["row", "=", "i", "row-i"],
                ["col", "=", "j", "col-j"],
                ["row", "=", "j+1", "row-jplus1"],
                ["col", "=", "k", "col-k"],
            ],
            showIndices: [
                ["row", "i"],
                ["row", "j+1"],
                ["col", "j"],
                ["col", "k"]
            ]
        }),

        new Vamonos.Widget.Pseudocode({
            container: "pseudocode",
            breakpoints: [7,9],
        }),

        new Vamonos.Widget.Controls({
            container: "controls",
            expandWidth: true,
        }),
        
    ],

    algorithm: function (_) {
        with (this) {
            var l;
            global.opt = {};
            global.sol = {};
            for (var _i = 1; _i < dim.length; _i++) {
_(1);               i = _i;
_(2);               global.opt[i] = {}; global.opt[i][i] = 0;
_(3);               global.sol[i] = {}; global.sol[i][i] = "M" + i;
            }
            i = null;
            for (l = 2; l < dim.length; _(4), l++) {
_(4);           for (var _i = 1; _i < dim.length - l + 1; _i++) {
_(5);               i = _i;
_(6);               k = i + l - 1;
_(7);               global.opt[i][k] = Infinity;
                    for (var _j = i; _j < k; _j++) {
_(8);                   j = _j;
_(9);                   if (global.opt[i][k] > dim[i-1]*dim[j]*dim[k] + 
                                                    global.opt[i][j] + 
                                                    global.opt[j+1][k]) {
_(10);                      global.opt[i][k] = dim[i-1]*dim[j]*dim[k] + 
                                global.opt[i][j] + global.opt[j+1][k];
_(11);                      global.sol[i][k] = 
                                "(" + global.sol[i][j] + " " + global.sol[j+1][k] + ")";
                        }
                    }
                    j = null;
                }
                i = null;
            }
        }
    },

});

</script>
</html>
